-- Generated by AutomateDV (formerly known as dbtvault)

    

WITH stage AS (
    SELECT TRANSACTION_PK, CUSTOMER_PK, ORDER_PK, TRANSACTION_NUMBER, TRANSACTION_DATE, TYPE, AMOUNT, EFFECTIVE_FROM, LOAD_DATE, RECORD_SOURCE
    FROM `trim-field-467501-p5`.`dbt_dataset`.`v_stg_transactions`
    WHERE TRANSACTION_PK IS NOT NULL
    AND CUSTOMER_PK IS NOT NULL
    AND ORDER_PK IS NOT NULL
),
records_to_insert AS (
    SELECT DISTINCT stg.TRANSACTION_PK, stg.CUSTOMER_PK, stg.ORDER_PK, stg.TRANSACTION_NUMBER, stg.TRANSACTION_DATE, stg.TYPE, stg.AMOUNT, stg.EFFECTIVE_FROM, stg.LOAD_DATE, stg.RECORD_SOURCE
    FROM stage AS stg
    
)

SELECT * FROM records_to_insert