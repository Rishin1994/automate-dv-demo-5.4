

  create or replace view `trim-field-467501-p5`.`dbt_dataset`.`v_stg_orders`
  OPTIONS()
  as 







WITH staging AS (
-- Generated by AutomateDV (formerly known as dbtvault)

    

WITH source_data AS (

    SELECT

    ORDERKEY,
    PARTKEY,
    SUPPLIERKEY,
    LINENUMBER,
    QUANTITY,
    EXTENDEDPRICE,
    DISCOUNT,
    TAX,
    RETURNFLAG,
    LINESTATUS,
    SHIPDATE,
    COMMITDATE,
    RECEIPTDATE,
    SHIPINSTRUCT,
    SHIPMODE,
    LINE_COMMENT,
    CUSTOMERKEY,
    ORDERSTATUS,
    TOTALPRICE,
    ORDERDATE,
    ORDERPRIORITY,
    CLERK,
    SHIPPRIORITY,
    ORDER_COMMENT,
    CUSTOMER_NAME,
    CUSTOMER_ADDRESS,
    CUSTOMER_NATION_KEY,
    CUSTOMER_PHONE,
    CUSTOMER_ACCBAL,
    CUSTOMER_MKTSEGMENT,
    CUSTOMER_COMMENT,
    CUSTOMER_NATION_NAME,
    CUSTOMER_REGION_KEY,
    CUSTOMER_NATION_COMMENT,
    CUSTOMER_REGION_NAME,
    CUSTOMER_REGION_COMMENT

    FROM `trim-field-467501-p5`.`dbt_dataset`.`raw_orders`
),

derived_columns AS (

    SELECT

    ORDERKEY,
    PARTKEY,
    SUPPLIERKEY,
    LINENUMBER,
    QUANTITY,
    EXTENDEDPRICE,
    DISCOUNT,
    TAX,
    RETURNFLAG,
    LINESTATUS,
    SHIPDATE,
    COMMITDATE,
    RECEIPTDATE,
    SHIPINSTRUCT,
    SHIPMODE,
    LINE_COMMENT,
    CUSTOMERKEY,
    ORDERSTATUS,
    TOTALPRICE,
    ORDERDATE,
    ORDERPRIORITY,
    CLERK,
    SHIPPRIORITY,
    ORDER_COMMENT,
    CUSTOMER_NAME,
    CUSTOMER_ADDRESS,
    CUSTOMER_NATION_KEY,
    CUSTOMER_PHONE,
    CUSTOMER_ACCBAL,
    CUSTOMER_MKTSEGMENT,
    CUSTOMER_COMMENT,
    CUSTOMER_NATION_NAME,
    CUSTOMER_REGION_KEY,
    CUSTOMER_NATION_COMMENT,
    CUSTOMER_REGION_NAME,
    CUSTOMER_REGION_COMMENT,
    CUSTOMERKEY AS CUSTOMER_KEY,
    CUSTOMER_NATION_KEY AS NATION_KEY,
    CUSTOMER_REGION_KEY AS REGION_KEY,
    'TPCH-ORDERS' AS RECORD_SOURCE,
    ORDERDATE AS EFFECTIVE_FROM

    FROM source_data
),

hashed_columns AS (

    SELECT

    ORDERKEY,
    PARTKEY,
    SUPPLIERKEY,
    LINENUMBER,
    QUANTITY,
    EXTENDEDPRICE,
    DISCOUNT,
    TAX,
    RETURNFLAG,
    LINESTATUS,
    SHIPDATE,
    COMMITDATE,
    RECEIPTDATE,
    SHIPINSTRUCT,
    SHIPMODE,
    LINE_COMMENT,
    CUSTOMERKEY,
    ORDERSTATUS,
    TOTALPRICE,
    ORDERDATE,
    ORDERPRIORITY,
    CLERK,
    SHIPPRIORITY,
    ORDER_COMMENT,
    CUSTOMER_NAME,
    CUSTOMER_ADDRESS,
    CUSTOMER_NATION_KEY,
    CUSTOMER_PHONE,
    CUSTOMER_ACCBAL,
    CUSTOMER_MKTSEGMENT,
    CUSTOMER_COMMENT,
    CUSTOMER_NATION_NAME,
    CUSTOMER_REGION_KEY,
    CUSTOMER_NATION_COMMENT,
    CUSTOMER_REGION_NAME,
    CUSTOMER_REGION_COMMENT,
    CUSTOMER_KEY,
    NATION_KEY,
    REGION_KEY,
    RECORD_SOURCE,
    EFFECTIVE_FROM,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(CUSTOMER_KEY AS STRING))), '')))) AS STRING) AS CUSTOMER_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_KEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_KEY AS STRING))), ''), '^^')
    ), '^^||^^')))) AS STRING) AS LINK_CUSTOMER_NATION_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_KEY AS STRING))), '')))) AS STRING) AS CUSTOMER_NATION_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(CUSTOMER_REGION_KEY AS STRING))), '')))) AS STRING) AS CUSTOMER_REGION_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_KEY AS STRING))), '')))) AS STRING) AS NATION_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(CUSTOMER_REGION_KEY AS STRING))), '')))) AS STRING) AS REGION_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_KEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_REGION_KEY AS STRING))), ''), '^^')
    ), '^^||^^')))) AS STRING) AS NATION_REGION_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), '')))) AS STRING) AS ORDER_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_KEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), ''), '^^')
    ), '^^||^^')))) AS STRING) AS ORDER_CUSTOMER_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LINENUMBER AS STRING))), ''), '^^')
    ), '^^||^^')))) AS STRING) AS LINEITEM_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LINENUMBER AS STRING))), ''), '^^')
    ), '^^||^^||^^')))) AS STRING) AS LINK_LINEITEM_ORDER_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(PARTKEY AS STRING))), '')))) AS STRING) AS PART_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(UPPER(TRIM(CAST(SUPPLIERKEY AS STRING))), '')))) AS STRING) AS SUPPLIER_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(PARTKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERKEY AS STRING))), ''), '^^')
    ), '^^||^^')))) AS STRING) AS INVENTORY_PK,

    CAST(UPPER(TO_HEX(MD5(NULLIF(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(LINENUMBER AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PARTKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERKEY AS STRING))), ''), '^^')
    ), '^^||^^||^^')))) AS STRING) AS INVENTORY_ALLOCATION_PK,

    CAST(UPPER(TO_HEX(MD5(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_ACCBAL AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_ADDRESS AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_COMMENT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_KEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_MKTSEGMENT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NAME AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_PHONE AS STRING))), ''), '^^')
    )))) AS STRING) AS CUSTOMER_HASHDIFF,

    CAST(UPPER(TO_HEX(MD5(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_COMMENT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_KEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_NATION_NAME AS STRING))), ''), '^^')
    )))) AS STRING) AS CUSTOMER_NATION_HASHDIFF,

    CAST(UPPER(TO_HEX(MD5(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_REGION_COMMENT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_REGION_KEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMER_REGION_NAME AS STRING))), ''), '^^')
    )))) AS STRING) AS CUSTOMER_REGION_HASHDIFF,

    CAST(UPPER(TO_HEX(MD5(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMMITDATE AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(DISCOUNT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(EXTENDEDPRICE AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LINE_COMMENT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LINENUMBER AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(LINESTATUS AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(QUANTITY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(RECEIPTDATE AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(RETURNFLAG AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPDATE AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPINSTRUCT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPMODE AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(TAX AS STRING))), ''), '^^')
    )))) AS STRING) AS LINEITEM_HASHDIFF,

    CAST(UPPER(TO_HEX(MD5(CONCAT(
        IFNULL(NULLIF(UPPER(TRIM(CAST(CLERK AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDER_COMMENT AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERDATE AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERKEY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERPRIORITY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERSTATUS AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPRIORITY AS STRING))), ''), '^^'), '||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(TOTALPRICE AS STRING))), ''), '^^')
    )))) AS STRING) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ORDERKEY,
    PARTKEY,
    SUPPLIERKEY,
    LINENUMBER,
    QUANTITY,
    EXTENDEDPRICE,
    DISCOUNT,
    TAX,
    RETURNFLAG,
    LINESTATUS,
    SHIPDATE,
    COMMITDATE,
    RECEIPTDATE,
    SHIPINSTRUCT,
    SHIPMODE,
    LINE_COMMENT,
    CUSTOMERKEY,
    ORDERSTATUS,
    TOTALPRICE,
    ORDERDATE,
    ORDERPRIORITY,
    CLERK,
    SHIPPRIORITY,
    ORDER_COMMENT,
    CUSTOMER_NAME,
    CUSTOMER_ADDRESS,
    CUSTOMER_NATION_KEY,
    CUSTOMER_PHONE,
    CUSTOMER_ACCBAL,
    CUSTOMER_MKTSEGMENT,
    CUSTOMER_COMMENT,
    CUSTOMER_NATION_NAME,
    CUSTOMER_REGION_KEY,
    CUSTOMER_NATION_COMMENT,
    CUSTOMER_REGION_NAME,
    CUSTOMER_REGION_COMMENT,
    CUSTOMER_KEY,
    NATION_KEY,
    REGION_KEY,
    RECORD_SOURCE,
    EFFECTIVE_FROM,
    CUSTOMER_PK,
    LINK_CUSTOMER_NATION_PK,
    CUSTOMER_NATION_PK,
    CUSTOMER_REGION_PK,
    NATION_PK,
    REGION_PK,
    NATION_REGION_PK,
    ORDER_PK,
    ORDER_CUSTOMER_PK,
    LINEITEM_PK,
    LINK_LINEITEM_ORDER_PK,
    PART_PK,
    SUPPLIER_PK,
    INVENTORY_PK,
    INVENTORY_ALLOCATION_PK,
    CUSTOMER_HASHDIFF,
    CUSTOMER_NATION_HASHDIFF,
    CUSTOMER_REGION_HASHDIFF,
    LINEITEM_HASHDIFF,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *,
       PARSE_DATE('%Y-%m-%d', '1992-01-08') AS LOAD_DATE
FROM staging;

